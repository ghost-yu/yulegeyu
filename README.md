# 鱼了个鱼

> 被羊了个羊虐了百遍后，我自己做了一个！

在线体验：http://yulegeyu.yupi.icu

游戏视频：https://www.bilibili.com/video/BV1Pe411M7wh

相关文章：https://mp.weixin.qq.com/s/D_I1Tq-ofhKhlp0rkOpaLA

游戏截图（自定义了图案）：

![游戏截图](doc/img.png)

游戏特色：

1. 支持选择难度（4 种）
2. 支持自定义难度
3. 支持自定义动物图案（比如 🐔🏀）
4. 可以无限使用技能（道具）
5. 不需要看广告
6. 能通关

> 补一句：就出于兴趣做了几个小时，有 bug 正常哈哈，欢迎 PR~

简单说下实现原理，主要有 4 个点：

1. 游戏全局参数：做游戏的同学都知道，游戏中会涉及很多参数，比如槽位数量、层数等等。我们要将这些参数抽取成统一的全局变量，供其他变量使用。从而做到修改一处，游戏自动适配。还可以提供页面来让用户自定义这些参数，提高游戏的可玩性。
2. 网格：为了让块的分布相对规整、并且为计算坐标提供方便，我将整个游戏画布分为 24 x 24 的虚拟网格，类似一个棋盘。一个块占用 3 x 3 的格子。
3. 随机生成块：包括随机生成方块的图案和坐标。首先我根据全局参数计算出了总块数，然后用 shuffle 函数打乱存储所有动物图案的数组，再依次将数组中的图案填充到方块中。生成坐标的原理是随机选取坐标范围内的点，坐标范围可以随着层级的增加而递减，即生成的图案越来越挤，达到难度逐层加大的效果。
4. 块的覆盖关系：怎么做到点击上层的块后，才能点下层的块呢？首先要给每个块指定一个层级属性。然后有两种思路，第 1 种是先逐层生成，然后每个格子里层级最高的块依次判断其周围格子有没有块层级大于它；第 2 种是在随机生成块的时候就给相互重叠的块绑定层级关系（即谁覆盖了我？我覆盖了谁？）。这里我选择了第 2 种方法，感觉效率会高一些。

## 在本地运行（快速开始）

在项目根目录运行以下命令（Windows cmd / PowerShell）：

```cmd
cd /d f:\BaiduSyncdisk\work\git\yulegeyu
npm install
npm run dev
```

启动成功后打开浏览器访问：http://localhost:5173/

常用脚本（见 `package.json`）:

- `npm run dev`：启动开发服务器（Vite）
- `npm run build`：构建生产包（包含类型检查 `vue-tsc`）
- `npm run preview`：本地预览构建后的代码

如果需要在局域网内其他设备访问，请使用：

```cmd
npm run dev -- --host
```

## 如何替换/自定义游戏素材（动物图案）

这个项目支持两种更换动物素材的方式：直接在代码中替换（静态）或在运行时通过配置页面自定义（动态）。

1) 通过代码替换（静态）

- 表情字符数组定义在 `src/core/gameConfig.ts` 文件顶端的 `animals` 常量。你可以直接编辑该数组，把默认的 emoji 替换成你想要的字符或 emoji：

	```ts
	// src/core/gameConfig.ts
	const animals = [
		"🐔",
		"🐟",
		"🦆",
		// ... 替换为你自己的符号或 emoji
	];
	```

- 修改后保存，重新启动或刷新页面即可看到生效。

2) 运行时通过“自定义难度”页面（推荐）

- 启动开发服务器并打开页面，进入“自定义难度”页面（`ConfigPage`）。
- 在“动物图案”输入框中输入你想要的连续字符或 emoji，例如： `🐶🐱🐼🐨`。
- 提交后游戏会使用你输入的字符序列作为动物素材（页面会把输入的字符串拆成数组）。

3) 使用图片素材（高级）

- 当前游戏默认使用字符（emoji）作为图案。如果你想用图片替换，需要在渲染逻辑中改为使用图片资源。
- 项目图片资源存放位置示例：`src/assets/`（当前包含 `bg.jpeg`, `kunkun.png`, `logo.png`, `vue.svg`）和 `public/`（含 `logo.png`）。
- 一个基本思路：
	1. 把图片放到 `src/assets/animals/`（你可以新建该文件夹）。
	2. 在 `src/core/game.ts` 的渲染逻辑中（搜索关键字 `animalBlocks` 或 `needAnimals`）替换输出字符渲染为 `<img>` 标签或 `background-image`，并把对应的 emoji 映射到图片路径。

示例（思路，不是完整补丁）：

```ts
// 在 gameConfig 或单独文件中维护映射
const emojiToImage = {
	"🐶": new URL('../assets/animals/dog.png', import.meta.url).href,
};

// 在渲染方块时，如果存在图片映射则渲染图片
// <img src="..." /> 或 使用 CSS background-image
```

如果你希望我直接把图片渲染的功能实现为可选开关（例如通过配置切换 emoji 与图片），告诉我我可以实现并提交 PR。

## 其他说明与常见问题

- 构建时会运行 `vue-tsc --noEmit` 做类型检查，若类型检查失败会阻止构建；请根据终端提示修复类型错误。
- 如果出现依赖或 Node 版本问题，建议使用 Node 16/18；可用 nvm 切换 Node 版本。
- 有安全告警：运行 `npm audit` 查看详情，`npm audit fix` 尝试自动修复。

欢迎 PR、Issues 或把你自定义的素材发给我，我可以帮你集成进项目。



